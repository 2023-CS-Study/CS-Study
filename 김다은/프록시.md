### 9. 프록시 서버

- 프록시 서버란?

  ```
  클라이언트에서 서버로 접속을 할 때 직접적으로 접속하지 않고 중간에 대신 전달해주는 서버를 의미합니다.
  즉, 클라이언트가 다른 네트워크 서비스에 간접적으로 접속할 수 있게 해주는 컴퓨터 시스템 or 응용 프로그램 입니다.
  ```



- CORS와 오리진

  - CORS(Cross-Origin Resource Sharing)
    - 서버가 웹 브라우저에서 리소스를 로드할 때 다른 오리진을 통해 로드하지 못하게 하는 HTTP 헤더 기반 메커니즘

  - 오리진
    - 프로토콜과 호스트 이름, 포트의 조합
    - ex) `http://localhost:8080`



- 프론트엔드 프록시 서버

  - 프론트엔드 서버와 백엔드 서버가 통신할 때 발생하는 CORS 에러를 해결하는 방법으로 사용
  - ex) 프론트엔드에서는 `127.0.0.1:3000`으로 테스팅하는데 백엔드 서버는 `127.0.0.1:12010`라면 포트 번호가 다르기 때문에 CORS 에러 발생

  -> 이때 프록시 서버를 둬서 프론트엔드 서버에서 요청되는 오리진을 `127.0.0.1:12010` 으로 바꾼다.



- 프록시 서버를 사용하는 이유
  - 보안
    - 서버의 IP를 숨기는 것이 가능하고 이는 외부로부터 위험을 막아주는 역할
  - 캐시
    - 사용자에 의해 빈번히 요청되는 데이터를 사용자와 지리적으로 가까운 웹캐시 서버에 보관
    - ex) 본 서버가 외국에 있고 프록시 서버가 한국에 있는 경우
  - 우회
    - IP를 통해 접속을 감지하는 사이트를 프록시 서버를 통해 우회할 수가 있다
  - 트래픽 분산
    - 일부 프록시 서버는 로드 밸런싱도 제공하여 여러 대의 분산된 서버가 있다면 서버의 트랙픽을 분산 시켜줌
    - ex) `Nginx`



### Reverse Proxy, Forward Proxy

- 포워드 프록시란?

  ```
  사용자가 google.com 에 연결하려고 하면 사용자 PC 가 직접 연결하는게 아니라 포워드 프록시 서버가 요청을 받아서  google.com 에 연결하여 그 결과를 클라이언트에 전달(forward) 해 줍니다.
  서버는 프록시 서버가 요청한 것만 알고 클아이언트가 누군지 모릅니다.
  ```

  ![img](프록시.assets/img.jpg)

  - 캐시 기능을 사용하기 때문에 캐시 서버로 활용하여 성능을 향상시킬 수 있다.
  - 클라이언트가 감춰진다.

- 리버스 프록시란?

  ```
  리버스 프락시로 웹 서버를 설정할 경우 사용자가 example.com 웹 서비스에 데이타를 요청하면 Reverse Proxy 는 이 요청을 받아서 내부 서버(보통 WAS 입니다)에서 데이타를 받은후에 이 데이타를 사용자에게 다시 전달하게 됩니다.
  클라이언트는 리버스 프록시를 실제 서버라고 생각하고 요청을 보냅니다.
  ```

  ![img](프록시.assets/img-16771590147556.jpg)

  - 클라이언트는 내부 서버를 접근하지 못하기 때문에 보안과 성능을 향상시킬 수 있다.
  - 여러개의 내부 서버를 둘 수 있기 때문에 로드 밸런싱이나 서버 확장을 통해 트래픽을 분산시킬 수 있다.
  - 실제 서버가 감춰진다.

- 인터넷이 먼저 호출되면, 리버스 프록시

- 프록시 서버가 먼저 호출되면, 포워드 프록시



### Nginx로 구성해보기

```
server {
  listen 80;
  location / {
    root   SPA 빌드파일 경로;
    index  index.html index.htm;
    try_files $uri $uri/ /index.html;
  }
  
  location /api {
    proxy_pass http://[서버 url];
  }
}

```

- `/api`경로로 접근하면 proxy_pass의 서버로 요청됨