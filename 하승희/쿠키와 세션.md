# 쿠키와 세션

## 쿠키와 세션을 사용하는 이유

- HTTP는 비연결성(Connectionless), 비상태성(Stateless)의 특성을 가집니다.
  - 비연결성 : 클라이언트가 request를 서버에 보내고, 서버가 클라이언트의 요청에 맞는 response를 보내면 연결을 바로 끊는다.
  - 비상태성 : 연결을 끊는 순간 클라이언트와 서버의 통신은 끝나며, 상태 정보를 유지하지 않는다.
- 따라서 서버는 클라이언트가 로그인을 했더라도, 이후 요청 때 해당 클라이언트가 로그인을 했었는지 아닌지 알 수 없습니다.
- HTTP 프로토콜에서 상태를 유지하기 위해 쿠키와 세션을 사용합니다.
  
---

## 쿠키(Cookie)

### 개념

- 클라이언트(브라우저) 로컬에 key-value 쌍으로 저장되는 데이터 파일입니다.
- 클라이언트의 상태 정보를 브라우저에 저장하여 참조합니다.
- 쿠키의 이름(Name), 값(Value), 만료 시간(Expires), 전송할 경로(Path) 등을 포함합니다.


### 동작 방식

1. 클라이언트가 서버에 페이지를 요청합니다.
2. 서버는 상태를 유지하고 싶은 값을 쿠키(cookie)로 생성하고, 응답 헤더(Set-Cookie)에 쿠키(key-value)를 포함해서 전송합니다.

    ```
    Set-Cookie: id=ariul
    ```

3. 응답을 받은 클라이언트는 해당 쿠키를 저장하고, 다음 요청 때 쿠키를 헤더에 담아 서버로 전송합니다.

    ```
    cookie: id=ariul
    ```

4. 서버는 쿠키 정보를 참조하여 응답합니다.

### 쿠키의 특징

- 만료 시간에 따라 브라우저를 종료하더라도 계속 유지될 수 있습니다.
- 클라이언트에 저장되어 있기 때문에 서버 자원의 낭비를 방지하며, 서버에 요청할 때 속도가 빠릅니다.
- 하지만 클라이언트 측에 저장되어 있고 휘발되지 않기 때문에 탈취되기 쉽다는 보안 문제가 있습니다.

---

## 세션(Session)

### 개념

- 브라우저로 웹 서버에 접속한 시점부터 브라우저를 종료하여 연결을 끝내는 시점까지의 일련의 요청을 하나의 상태로 간주하고, 그 상태를 일정하게 유지하는 기술입니다.
- 사용자 정보를 브라우저에 저장하는 쿠키와 달리 세션은 서버 측에 저장하여 관리합니다.
- 세션도 쿠키를 사용하여 값을 주고받으며 클라이언트의 상태 정보를 유지합니다.

### 동작 방식

1. 클라이언트가 HTTP 요청의 Body에 인증 정보를 실어 서버로 전송합니다.
2. 서버는 클라이언트를 구분하기 위해 각 클라이언트에게 Session ID를 부여하고, 응답 헤더(Set-Cookie)에 Session ID를 포함해서 전송합니다.

    ```
    Set-Cookie: JSESSIONID=3CB361E0BE1AE7DB926DF0772BAE
    ```

3. 클라이언트는 해당 Session ID를 쿠키(Cookie)에 저장하고, 매 요청마다 부여된 Session ID를 Cookie 헤더에 실어 전송합니다.

    ```
    Cookie: JSESSIONID=3CB361E0BE1AE7DB926DF0772BAE
    ```

4. 서버는 전달받은 Session ID에 해당하는 정보를 참조하여 응답합니다.

### 세션의 특징

- 세션은 유효시간을 두어 일정 시간 응답이 없다면 끊을 수 있고, 브라우저가 종료될 때까지 인증 상태를 유지할 수 있습니다.
- 사용자 정보를 서버에 두기 때문에 쿠키보다 보안은 좋지만 서버 자원을 차지하기 때문에 서버에 과부하를 줄 수 있고 성능 저하의 요인이 될 수 있습니다.

## 🔍 궁금한 점

> ❓ Session ID를 쿠키에 저장한다고요? 그럼 쿠키는 세션 유지를 위해 존재하나요?

아닙니다. 쿠키는 브라우저의 다양한 정보들을 저장해 주는 곳이고, 세션 ID는 그 저장소를 빌린 것뿐입니다.

**쿠키 사용 예시**

- 세션 관리: 쇼핑몰 장바구니 기능, 자동 로그인 등
- 개인화: 맞춤형 콘텐츠 제공을 위해 개인화된 정보 저장, 테마 설정 유지 등

> ❓ 세션이 보안도 좋은데 왜 쿠키를 사용하나요?


세션은 서버의 자원을 사용하기 때문에 무분별하게 만들다 보면 서버가 느려질 수 있고 서버 자원이 부족할 수 있습니다. 따라서 서버 자원의 낭비를 방지하여 웹사이트 속도를 높이는 쿠키가 유리한 경우가 있습니다.

> ❓ 쿠키를 써야 하는데 보안도 필요하면 어떡하나요?

반드시 쿠키를 사용해야 하는 상황이라면 보안 속성을 통해 보안 문제를 보완할 수 있습니다.
- 보안 속성 1. Secure
    - 원래 쿠키는 HTTP, HTTPS 구분하지 않고 전송할 수 있습니다.
    - 하지만 Set-Cookie 응답 헤더에 이 보안 속성이 명시된 쿠키는 HTTPS인 경우에만 클라이언트에서 서버로 전송합니다.
- 보안 속성 2. HttpOnly
    - 원래 쿠키는 자바스크립트로 Document.cookie 객체를 통해 접근할 수 있습니다.
    - Set-Cookie 응답 헤더에 이 보안 속성이 명시된 쿠키는 자바스크립트로 접근할 수 없으며, HTTP 전송에만 사용됩니다.
- 보안 속성 3. SameSite
    - Set-Cookie 응답 헤더에 이 보안 속성이 명시된 쿠키는 현재 요청하는 도메인과 쿠키에 설정된 도메인이 같은 경우에만 전송할 수 있습니다.

---

### Reference

- [모든 개발자를 위한 HTTP 웹 기본 지식](https://www.inflearn.com/course/http-%EC%9B%B9-%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%AC/dashboard)
- [쿠키와 세션 (ft. HTTP의 비연결성과 비상태성)](https://hudi.blog/cookie-and-session/)
- [쿠키와 세션을 긴밀하게 이해하는 법](https://velog.io/@ksi05503/%EC%BF%A0%ED%82%A4%EC%99%80-%EC%84%B8%EC%85%98%EC%9D%84-%EA%B8%B4%EB%B0%80%ED%95%98%EA%B2%8C-%EC%9D%B4%ED%95%B4%ED%95%98%EB%8A%94-%EB%B2%95)
