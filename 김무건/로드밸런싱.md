## 로드밸런서

- 로드 밸런싱은 네트워크 또는 서버에 가해지는 부하를 분산해주는 기술을 의미
- 로드 밸런서는 로드 밸런싱 기술을 제공하는 서비스 또는 장치를 의미

- 로드 밸런서는 클라이언트와 서버 사이에 위치하며 VIP(Virtual Ip)
- 와 함께 구성된다. 또한 특정 서버에 부하가 집중되지 않도록 트래픽을 다양한 방법으로 분산하여 서버의 성능을 최적화

기능

1. 상태확인
    - 서버들에 대한 주기적인 상태 확인을 통하여 서버의 장애 여부를 판단할 수 있다. 서버에 이상이 생기면 정상적인 동작하는 서버로 트래픽을 보내는 Fail-Over가 가능하다. → 또한 TCP/UDP 분석이 가능하기 때문에 방화벽 역할도 가능
    - L4 체크: TCP의 3-way handshaking을 통해 각 서버의 포트 상태를 확인한다.
    - L7 체크: 애플리케이션 계층에서 체크하는 방법으로 실제 웹 페이지에 통신을 시도해 이상 유무를 파악한다.

1. 터널링
    1. 인터넷 상에서 눈에 보이지 않는 통로를 만들어 통신할 수 있게 하는 개념
    2. 데이터를 캡슐화해서 연결된 상호 간에만 캡슐화된 패킷을 구별해 캡슐화를 해제할 수 있다.

1. NAT(Network Address Translation)
    1. IP주소를 변환해 주는 기능 → 여러 개의 호스트가 하나의 공인 IP 주소를 통해 접속하는 것이 주 목적

### *****L4 로드 밸런서*****

---

- 네트워크 계층 , 트랜스포트 계층의 정보를 바탕으로 부하를 분산한다.

→ IP주소 , 포트 번호 , MAC주소 , 전송 프로토콜 등에 따라 트래픽 분산

- TCP/UDP 포트 이용하여 트래픽 분산처리 → 로드밸런싱을 수행

- 외부에서 들어오는 모든 요청은 L4 스위치를 거친다. 이후 서버에게 적절하게 나누어주는 개념

→ L4 스위치의 주요역할 : **부하분산**

### 로드 밸런싱 방법

- **라운드 로빈** (Round Robin)
    - 요청이 들어오는 대로 서버마다 균등하게 요청을 분배한다. 단순히 순서에 따라 세션을 할당하므로 경우에 따라 경로 별로 같은 처리량이 보장되지 않는다.

- **가중치 및 비율 할당 방식** (Weighted Round Robin Scheduling)
    - 라운드 로빈 방식으로 분배하지만, 서버의 가중치에 따라 요청을 더 분배하기도, 덜 분배하기도 한다. 서버 가중치는 사용자가 지정할 수 있고, 동적으로 조정되기도 한다. 특정 서버의 성능이 월등히 뛰어나다면 해당 서버에게 높은 가중치를 부여한다.

- **최소 연결** (Least Connection)
    - 가장 적은 세션을 가진 서버로 트래픽을 보내는 방식이다. 가장 많이 사용되는 방식이라고 한다.

- 가장 빠른 응답 시간 (Fastest Response Time)
    - 가장 빠른 응답 시간을 보내는 서버로 트래픽을 보내 주는 방식이다. 각 서버들의 가용 가능한 리소스와 성능, 그리고 처리 중인 데이터 등이 다를 경우 적합한 방식이다.

- 해시 기반 스케줄링 (Source hash Scheduling)
    - 사용자의 IP를 해싱한 후 그 결과에 따라 서버로 요청을 분배하기 때문에 특정 클라이언트는 특정 서버로만 할당하는 방식이다.

- 대역폭 (Bandwidth) 기반
    - 서버들과의 대역폭을 고려하여 트래픽을 분산하는 방식이다.

</br>
</br>
    
### L7 스위치

---

- L7은 어플리케이션 영역입니다.

OSI 3~7에 속하는 IP주소 및 TCP/UDP 포트 정보 및 패킷 내용을 모두 확인하고 스위칭

- HTTP의 URL FTP 쿠키 정보 및 바이러스 패턴을 분석하여 **보안에 더 유리하게 로드 밸런싱**
- EX) Traffic Filter , Security , VPN

![image](https://user-images.githubusercontent.com/103854287/221393681-b7e56e50-1f59-4325-8ab3-a82ef60c8a85.png)

### 로드 밸런싱 방법

- URL 스위칭 방식 (URL Switching)
    - 특정 하위 URL들은 특정 서버로 처리하는 방식이다. 예를 들어, '.../images' 또는 '.../video'와 같은 URL은 서버가 아닌 별도의 스토리지에 있는 객체 데이터로 바로 연결되도록 구성할 수 있다.

- 컨텍스트 스위칭 방식 (Context Switching)
    - 클라이언트가 요청한 특정 리소스에 따라 특정 서버로 연결할 수 있다. 예를 들어, 이미지 파일에 대해서는 확장자를 참조해 별도로 구성된 이미지 파일이 있는 서버 또는 스토리지 직접 연결해 줄 수 있다.

- 쿠키 지속성 (Persistence with Cookies)
    - 쿠키 정보를 바탕으로 클라이언트가 연결했었던 서버에 계속 할당해 주는 방식이다.

